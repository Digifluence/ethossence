{%- comment -%}
  ETHOSSENCE PRODUCT COMPLETE SOLUTION SECTION

  Displays complete system/solution recommendations for products.
  Shows groups of recommended products and variants to complement the main product.

  Metafield: ethossence.solutions_complete (list metaobject reference)
  Metaobject type: solutions_complete
  Fields:
    - group_heading (single line text)
    - group_note (multi-line text)
    - group_required_choice (boolean)
    - complete_system_products (list product) - displays all variants of each product
    - complete_system_product_variants (list product variant) - displays specific variants
{%- endcomment -%}

{%- liquid
  # Get the solutions_complete metaobject list from the product
  assign solution_groups = product.metafields.ethossence.solutions_complete.value

  # Check if there are any solution groups
  assign show_section = false
  if solution_groups != blank and solution_groups.size > 0
    assign show_section = true
  endif
-%}

<pre>Hello 2026-01-19 A</pre>

{%- if show_section -%}
  {{ 'ethossence-product-complete-solution.css' | asset_url | stylesheet_tag }}

  {%- style -%}
    .section-{{ section.id }}-padding {
      padding-top: {{ section.settings.padding_top | times: 0.75 | round: 0 }}px;
      padding-bottom: {{ section.settings.padding_bottom | times: 0.75 | round: 0 }}px;
    }

    @media screen and (min-width: 750px) {
      .section-{{ section.id }}-padding {
        padding-top: {{ section.settings.padding_top }}px;
        padding-bottom: {{ section.settings.padding_bottom }}px;
      }
    }
  {%- endstyle -%}

  <div class="section-{{ section.id }}-padding color-{{ section.settings.color_scheme }} gradient">
    <div class="page-width">
      <div class="complete-solution">

        {%- comment -%} Section Heading {%- endcomment -%}
        {%- if section.settings.heading != blank -%}
          <h2 class="complete-solution__section-heading {{ section.settings.heading_size }}">
            {{ section.settings.heading }}
          </h2>
        {%- endif -%}

        {%- comment -%} Loop through each solution group {%- endcomment -%}
        {%- for group in solution_groups -%}
          <div class="complete-solution__group">

            {%- comment -%} Group Heading {%- endcomment -%}
            {%- if group.group_heading != blank -%}
              <div class="complete-solution__header">
                <h3 class="complete-solution__group-heading">
                  {{ group.group_heading }}
                  {%- if group.group_required_choice -%}
                    <span class="complete-solution__required-badge">Required</span>
                  {%- endif -%}
                </h3>
              </div>
            {%- endif -%}

            {%- comment -%} Group Note {%- endcomment -%}
            {%- if group.group_note != blank -%}
              <div class="complete-solution__note rte">
                {{ group.group_note }}
              </div>
            {%- endif -%}

            <div class="complete-solution__items-list">

              {%- comment -%} Complete System Products - Display all variants for each product {%- endcomment -%}
              {%- assign system_products = group.complete_system_products.value -%}
              {%- if system_products != blank and system_products.size > 0 -%}
                {%- for system_product in system_products -%}
                  {%- for variant in system_product.variants -%}
                    <div class="complete-solution__item">

                      {%- comment -%} Variant Image {%- endcomment -%}
                      <div class="complete-solution__item-image">
                        {%- if variant.image != blank -%}
                          {{ variant.image | image_url: width: 300 | image_tag:
                            loading: 'lazy',
                            widths: '150, 300, 450',
                            sizes: '(min-width: 750px) 200px, 150px',
                            alt: variant.title
                          }}
                        {%- elsif system_product.featured_image != blank -%}
                          {{ system_product.featured_image | image_url: width: 300 | image_tag:
                            loading: 'lazy',
                            widths: '150, 300, 450',
                            sizes: '(min-width: 750px) 200px, 150px',
                            alt: system_product.title
                          }}
                        {%- else -%}
                          <div class="complete-solution__no-image">
                            {{ 'product-1' | placeholder_svg_tag: 'placeholder-svg' }}
                          </div>
                        {%- endif -%}
                      </div>

                      {%- comment -%} Item Details {%- endcomment -%}
                      <div class="complete-solution__item-details">
                        <h4 class="complete-solution__item-title">
                          <a href="{{ system_product.url }}">
                            {{ system_product.title }}
                          </a>
                        </h4>

                        {%- if variant.title != 'Default Title' -%}
                          <p class="complete-solution__item-variant">
                            {{ variant.title }}
                          </p>
                        {%- endif -%}

                        {%- if variant.sku != blank -%}
                          <p class="complete-solution__item-sku">
                            SKU: {{ variant.sku }}
                          </p>
                        {%- endif -%}
                      </div>

                      {%- comment -%} Price {%- endcomment -%}
                      <div class="complete-solution__item-price">
                        {%- if variant.compare_at_price > variant.price -%}
                          <span class="complete-solution__price--sale">
                            {{ variant.price | money }}
                          </span>
                          <span class="complete-solution__price--compare">
                            <s>{{ variant.compare_at_price | money }}</s>
                          </span>
                        {%- else -%}
                          <span class="complete-solution__price">
                            {{ variant.price | money }}
                          </span>
                        {%- endif -%}
                      </div>

                      {%- comment -%} Add to Cart {%- endcomment -%}
                      <div class="complete-solution__item-action">
                        {%- if variant.available -%}
                          <form method="post" action="/cart/add" class="complete-solution__form">
                            <input type="hidden" name="id" value="{{ variant.id }}">
                            <input type="hidden" name="quantity" value="1">
                            <button type="submit" class="button complete-solution__add-btn">
                              {{ 'products.product.add_to_cart' | t }}
                            </button>
                          </form>
                        {%- else -%}
                          <button type="button" class="button complete-solution__add-btn" disabled>
                            {{ 'products.product.sold_out' | t }}
                          </button>
                        {%- endif -%}
                      </div>

                    </div>
                  {%- endfor -%}
                {%- endfor -%}
              {%- endif -%}

              {%- comment -%} Complete System Product Variants - Display specific pre-selected variants {%- endcomment -%}
              {%- assign system_variants = group.complete_system_product_variants.value -%}
              {%- if system_variants != blank and system_variants.size > 0 -%}
                {%- for variant in system_variants -%}
                  {%- assign variant_product = variant.product -%}
                  <div class="complete-solution__item">

                    {%- comment -%} Variant Image {%- endcomment -%}
                    <div class="complete-solution__item-image">
                      {%- if variant.image != blank -%}
                        {{ variant.image | image_url: width: 300 | image_tag:
                          loading: 'lazy',
                          widths: '150, 300, 450',
                          sizes: '(min-width: 750px) 200px, 150px',
                          alt: variant.title
                        }}
                      {%- elsif variant_product.featured_image != blank -%}
                        {{ variant_product.featured_image | image_url: width: 300 | image_tag:
                          loading: 'lazy',
                          widths: '150, 300, 450',
                          sizes: '(min-width: 750px) 200px, 150px',
                          alt: variant_product.title
                        }}
                      {%- else -%}
                        <div class="complete-solution__no-image">
                          {{ 'product-1' | placeholder_svg_tag: 'placeholder-svg' }}
                        </div>
                      {%- endif -%}
                    </div>

                    {%- comment -%} Item Details {%- endcomment -%}
                    <div class="complete-solution__item-details">
                      <h4 class="complete-solution__item-title">
                        <a href="{{ variant_product.url }}">
                          {{ variant_product.title }}
                        </a>
                      </h4>

                      {%- if variant.title != 'Default Title' -%}
                        <p class="complete-solution__item-variant">
                          {{ variant.title }}
                        </p>
                      {%- endif -%}

                      {%- if variant.sku != blank -%}
                        <p class="complete-solution__item-sku">
                          SKU: {{ variant.sku }}
                        </p>
                      {%- endif -%}
                    </div>

                    {%- comment -%} Price {%- endcomment -%}
                    <div class="complete-solution__item-price">
                      {%- if variant.compare_at_price > variant.price -%}
                        <span class="complete-solution__price--sale">
                          {{ variant.price | money }}
                        </span>
                        <span class="complete-solution__price--compare">
                          <s>{{ variant.compare_at_price | money }}</s>
                        </span>
                      {%- else -%}
                        <span class="complete-solution__price">
                          {{ variant.price | money }}
                        </span>
                      {%- endif -%}
                    </div>

                    {%- comment -%} Add to Cart {%- endcomment -%}
                    <div class="complete-solution__item-action">
                      {%- if variant.available -%}
                        <form method="post" action="/cart/add" class="complete-solution__form">
                          <input type="hidden" name="id" value="{{ variant.id }}">
                          <input type="hidden" name="quantity" value="1">
                          <button type="submit" class="button complete-solution__add-btn">
                            {{ 'products.product.add_to_cart' | t }}
                          </button>
                        </form>
                      {%- else -%}
                        <button type="button" class="button complete-solution__add-btn" disabled>
                          {{ 'products.product.sold_out' | t }}
                        </button>
                      {%- endif -%}
                    </div>

                  </div>
                {%- endfor -%}
              {%- endif -%}

            </div>
          </div>
        {%- endfor -%}

      </div>
    </div>
  </div>
{%- endif -%}

{% schema %}
{
  "name": "Complete Solution",
  "tag": "section",
  "class": "section",
  "enabled_on": {
    "templates": ["product"]
  },
  "settings": [
    {
      "type": "text",
      "id": "heading",
      "label": "Section heading",
      "default": "Complete Your System"
    },
    {
      "type": "select",
      "id": "heading_size",
      "label": "Heading size",
      "options": [
        { "value": "h2", "label": "Small" },
        { "value": "h1", "label": "Medium" },
        { "value": "h0", "label": "Large" }
      ],
      "default": "h1"
    },
    {
      "type": "color_scheme",
      "id": "color_scheme",
      "label": "t:sections.all.colors.label",
      "default": "scheme-1"
    },
    {
      "type": "header",
      "content": "Section padding"
    },
    {
      "type": "range",
      "id": "padding_top",
      "min": 0,
      "max": 100,
      "step": 4,
      "unit": "px",
      "label": "t:sections.all.padding.padding_top",
      "default": 36
    },
    {
      "type": "range",
      "id": "padding_bottom",
      "min": 0,
      "max": 100,
      "step": 4,
      "unit": "px",
      "label": "t:sections.all.padding.padding_bottom",
      "default": 36
    }
  ],
  "presets": [
    {
      "name": "Complete Solution"
    }
  ]
}
{% endschema %}
